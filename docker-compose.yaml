
services:
  jellyfin:
    image: jellyfin/jellyfin:10.10.7
    container_name: jellyfin
    network_mode: host
    user: 1000:1000
    restart: unless-stopped
    environment:
      - TZ=Europe/Bucharest

    volumes:
      # Named volumes for persistent configuration and cache data
      - jellyfin-config:/config
      - jellyfin-cache:/cache

      # Bind mounts for media libraries (Source:Target)
      - /media/shitflix/shows:/shows
      - /media/aux/shows:/aux_shows
      - /media/shitflix/movies:/movies
      - /media/aux/movies:/aux_movies

    # Configuration for GPU passthrough
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]

  torrent-client:
    build:
      context: .
      dockerfile: Dockerfile-torrent-client
    container_name: transmission
    ports:
      - "9091:9091"
    volumes:
      - ${DOWNLOADS_DIR}:/downloads
      - ${INCOMPLETE_DIR}:/incomplete
      - transmission-config:/config
      - shitflix:/shitflix
    env_file:
      - .env
    secrets:
      - filelist-api-key
      - tmdb-api-key
    restart: unless-stopped

volumes:
  transmission-config:
  shitflix:
  jellyfin-config:
  jellyfin-cache:

secrets:
  filelist-api-key:
    file: ./secrets/filelist-api-key.txt
  tmdb-api-key:
    file: ./secrets/tmdb-api-key.txt